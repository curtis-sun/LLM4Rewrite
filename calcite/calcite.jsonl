{"input_sql": "select z + x from (\n  select x + y as z, x from (\n    select * from (values (10, 1), (30, 3)) as t (x, y)\n    where x + y > 50) as t) as t;", "rewrites": [{"name": "testEmptyProject2", "output_sql": "SELECT *\nFROM (VALUES (CAST(NULL AS INTEGER))) AS \"t\" (\"expr$0\")\nWHERE 1 = 0;"}, {"name": "testEmptyProject", "output_sql": "SELECT *\nFROM (VALUES (CAST(NULL AS INTEGER))) AS \"t\" (\"expr$0\")\nWHERE 1 = 0;"}]}
{"input_sql": "select * from (\nselect * from (values (10, 1), (30, 3)) as t (x, y)\nunion all\nselect * from (values (20, 2)) as t (x, y)\n) as t\nwhere x + y > 30;", "rewrites": [{"name": "testEmptyFilterProjectUnion", "output_sql": "SELECT *\nFROM (VALUES (30, 3)) AS \"t\" (\"x\", \"y\");"}]}
{"input_sql": "select * from\n(select NAME, DEPTNO, count(*) over (partition by NAME) from dept) t\nwhere DEPTNO = 0;", "rewrites": [{"name": "testNotPushFilterPastWindowWhenPredicateNotOnPartitionKey", "output_sql": "SELECT \"name\", \"deptno\", COUNT(*) OVER (PARTITION BY \"name\" RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)\nFROM \"dept\"\nWHERE \"deptno\" = 0;"}]}
{"input_sql": "select * from emp\nwhere EXISTS (\n  select * from emp e where emp.deptno = e.deptno)\nAND NOT EXISTS (\n  select * from emp ee where ee.job = emp.job AND ee.sal=34);", "rewrites": [{"name": "testDecorrelateTwoExists", "output_sql": "SELECT \"emp\".\"empno\", \"emp\".\"ename\", \"emp\".\"job\", \"emp\".\"mgr\", \"emp\".\"hiredate\", \"emp\".\"sal\", \"emp\".\"comm\", \"emp\".\"deptno\", \"emp\".\"slacker\"\nFROM \"emp\"\n    INNER JOIN (SELECT \"deptno0\", TRUE AS \"$f1\"\n        FROM \"emp\" AS \"emp0\" (\"empno0\", \"ename0\", \"job0\", \"mgr0\", \"hiredate0\", \"sal0\", \"comm0\", \"deptno0\", \"slacker0\")\n        GROUP BY \"deptno0\") AS \"t1\" ON \"emp\".\"deptno\" = \"t1\".\"deptno0\"\n    LEFT JOIN (SELECT \"job1\", TRUE AS \"$f10\"\n        FROM \"emp\" AS \"emp1\" (\"empno1\", \"ename1\", \"job1\", \"mgr1\", \"hiredate1\", \"sal1\", \"comm1\", \"deptno1\", \"slacker1\")\n        WHERE \"sal1\" = 34\n        GROUP BY \"job1\") AS \"t5\" ON \"emp\".\"job\" = \"t5\".\"job1\"\nWHERE \"t5\".\"$f10\" IS NULL;"}]}
{"input_sql": "select * from (values (30, 3)) as t (x, y)\nwhere x > 30\nexcept\nselect * from (values (20, 2)) as t (x, y)\nexcept\nselect * from (values (40, 4)) as t (x, y);", "rewrites": [{"name": "testEmptyMinus", "output_sql": "SELECT *\nFROM (VALUES (CAST(NULL AS INTEGER), CAST(NULL AS INTEGER))) AS \"t\" (\"x\", \"y\")\nWHERE 1 = 0;"}]}
{"input_sql": "select empno, deptno, w_count from (\n  select empno, deptno, count(empno) over (ROWS BETWEEN 10 PRECEDING AND 1 PRECEDING) w_count\n  from emp\n) sub_query where w_count is null;", "rewrites": [{"name": "testIsNullPushDown2", "output_sql": "SELECT \"empno\", \"deptno\", \"$2\" AS \"w_count\"\nFROM (VALUES (CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS BIGINT))) AS \"t\" (\"empno\", \"deptno\", \"$2\")\nWHERE 1 = 0;"}]}
{"input_sql": "SELECT sal, SUM(comm), MIN(comm), SUM(DISTINCT sal)\nFROM emp\nGROUP BY sal;", "rewrites": [{"name": "testDistinctWithGrouping", "output_sql": "SELECT \"sal\", SUM(\"expr$1\"), MIN(\"expr$2\"), SUM(\"sal\")\nFROM (SELECT \"sal\", SUM(\"comm\") AS \"expr$1\", MIN(\"comm\") AS \"expr$2\"\n        FROM \"emp\"\n        GROUP BY \"sal\") AS \"t0\"\nGROUP BY \"sal\";"}]}
{"input_sql": "select sal from emp\nwhere empno NOT IN (\n  select deptno from dept\n  where emp.job = dept.name);", "rewrites": [{"name": "testWhereNotInCorrelated", "output_sql": "SELECT \"emp\".\"sal\"\nFROM \"emp\"\n    LEFT JOIN (SELECT COUNT(*) AS \"c\", COUNT(*) AS \"c0\", \"name\"\n        FROM \"dept\" AS \"dept\" (\"deptno0\", \"name\")\n        GROUP BY \"name\") AS \"t1\" ON \"emp\".\"job\" = \"t1\".\"name\"\n    LEFT JOIN (SELECT \"deptno1\", TRUE AS \"i\", \"name0\"\n        FROM \"dept\" AS \"dept1\" (\"deptno1\", \"name0\")) AS \"t2\" ON \"emp\".\"empno\" = \"t2\".\"deptno1\" AND \"emp\".\"job\" = \"t2\".\"name0\"\nWHERE \"t1\".\"c\" = 0 OR (\"t2\".\"i\" IS NOT NULL OR \"t1\".\"c0\" < \"t1\".\"c\") IS NOT TRUE;"}]}
{"input_sql": "select empno > ANY (\n  select deptno from dept where emp.job = dept.name)\nfrom emp;", "rewrites": [{"name": "testSelectAnyCorrelated", "output_sql": "SELECT CAST(\"emp\".\"empno\" > \"t1\".\"m\" IS TRUE AND (\"t1\".\"trueliteral\" IS NULL OR \"t1\".\"c\" = 0) IS NOT TRUE OR \"t1\".\"c\" > \"t1\".\"c0\" IS TRUE AND NULL AND (\"t1\".\"trueliteral\" IS NULL OR \"t1\".\"c\" = 0) IS NOT TRUE AND \"emp\".\"empno\" > \"t1\".\"m\" IS NOT TRUE OR \"emp\".\"empno\" > \"t1\".\"m\" AND (\"t1\".\"trueliteral\" IS NULL OR \"t1\".\"c\" = 0) IS NOT TRUE AND \"emp\".\"empno\" > \"t1\".\"m\" IS NOT TRUE AND \"t1\".\"c\" > \"t1\".\"c0\" IS NOT TRUE AS BOOLEAN)\nFROM \"emp\"\n    LEFT JOIN (SELECT MIN(\"deptno0\") AS \"m\", COUNT(*) AS \"c\", COUNT(*) AS \"c0\", TRUE AS \"trueliteral\", \"name\"\n        FROM \"dept\" AS \"dept\" (\"deptno0\", \"name\")\n        GROUP BY \"name\") AS \"t1\" ON \"emp\".\"job\" = \"t1\".\"name\";"}]}
{"input_sql": "select sal from emp where empno IN (\n  select deptno from dept where emp.job = dept.name);", "rewrites": [{"name": "testWhereInCorrelated", "output_sql": "SELECT \"emp\".\"sal\"\nFROM \"emp\"\n    INNER JOIN (SELECT *\n        FROM \"dept\" AS \"dept\" (\"deptno0\", \"name\")) AS \"t\" ON \"emp\".\"job\" = \"t\".\"name\" AND \"emp\".\"empno\" = \"t\".\"deptno0\";"}]}
{"input_sql": "select *\nfrom emp e right join dept d\non e.deptno = d.deptno and e.empno = d.deptno;", "rewrites": [{"name": "testJoinConditionPushdown6", "output_sql": "SELECT *\nFROM (SELECT *\n        FROM \"emp\"\n        WHERE \"deptno\" = \"empno\") AS \"t\"\n    RIGHT JOIN \"dept\" AS \"dept0\" (\"deptno0\", \"name\") ON \"t\".\"deptno\" = \"dept0\".\"deptno0\";"}]}
{"input_sql": "select * from emp\nwhere sal = 4\nor empno NOT IN (select deptno from dept);", "rewrites": [{"name": "testWhereOrSubQuery", "output_sql": "SELECT \"emp\".\"empno\", \"emp\".\"ename\", \"emp\".\"job\", \"emp\".\"mgr\", \"emp\".\"hiredate\", \"emp\".\"sal\", \"emp\".\"comm\", \"emp\".\"deptno\", \"emp\".\"slacker\"\nFROM \"emp\"\n    LEFT JOIN (SELECT \"deptno0\", TRUE AS \"i\"\n        FROM \"dept\" AS \"dept\" (\"deptno0\", \"name\")) AS \"t\" ON \"emp\".\"empno\" = \"t\".\"deptno0\"\nWHERE \"emp\".\"sal\" = 4 OR \"t\".\"i\" IS NULL;"}]}
{"input_sql": "select * from emp e1\n  where e1.empno > SOME (select deptno from dept);", "rewrites": [{"name": "testSome", "output_sql": "SELECT \"emp\".\"empno\", \"emp\".\"ename\", \"emp\".\"job\", \"emp\".\"mgr\", \"emp\".\"hiredate\", \"emp\".\"sal\", \"emp\".\"comm\", \"emp\".\"deptno\", \"emp\".\"slacker\"\nFROM \"emp\",\n        (SELECT MIN(\"deptno0\") AS \"m\", COUNT(*) AS \"c\", COUNT(*) AS \"c0\"\n        FROM \"dept\" AS \"dept\" (\"deptno0\", \"name\")) AS \"t1\"\nWHERE \"emp\".\"empno\" > \"t1\".\"m\" IS TRUE AND \"t1\".\"c\" <> 0 OR \"t1\".\"c\" > \"t1\".\"c0\" AND NULL AND \"t1\".\"c\" <> 0 AND \"emp\".\"empno\" > \"t1\".\"m\" IS NOT TRUE OR \"emp\".\"empno\" > \"t1\".\"m\" AND \"t1\".\"c\" <> 0 AND \"emp\".\"empno\" > \"t1\".\"m\" IS NOT TRUE AND \"t1\".\"c\" <= \"t1\".\"c0\";"}]}
{"input_sql": "select e.job,\n  min(sal) as min_sal, min(e.deptno) as min_deptno,\n  sum(sal) + 1 as sum_sal_plus, max(sal) as max_sal,\n  sum(sal) as sum_sal_2, count(sal) as count_sal,\n  count(mgr) as count_mgr\nfrom emp as e\njoin dept as d on e.job = d.name\ngroup by e.job,d.name;", "rewrites": [{"name": "testPushAggregateFunctionsThroughJoin", "output_sql": "SELECT \"t\".\"job\", \"t\".\"min_sal\", \"t\".\"min_deptno\", CAST(\"t\".\"sum_sal_2\" * \"t0\".\"$f1\" AS INTEGER) + 1 AS \"sum_sal_plus\", \"t\".\"max_sal\", CAST(\"t\".\"sum_sal_2\" * \"t0\".\"$f1\" AS INTEGER) AS \"$f9\", \"t\".\"count_sal\" * \"t0\".\"$f1\" AS \"$f10\", \"t\".\"count_mgr\" * \"t0\".\"$f1\" AS \"$f11\"\nFROM (SELECT \"job\", MIN(\"sal\") AS \"min_sal\", MIN(\"deptno\") AS \"min_deptno\", SUM(\"sal\") AS \"sum_sal_2\", MAX(\"sal\") AS \"max_sal\", COUNT(*) AS \"count_sal\", COUNT(\"mgr\") AS \"count_mgr\"\n        FROM \"emp\"\n        GROUP BY \"job\") AS \"t\"\n    INNER JOIN (SELECT \"name\", COUNT(*) AS \"$f1\"\n        FROM \"dept\" AS \"dept\" (\"deptno0\", \"name\")\n        GROUP BY \"name\") AS \"t0\" ON \"t\".\"job\" = \"t0\".\"name\";"}]}
{"input_sql": "select * from (\n  select upper(substring(x FROM 1 FOR 2) || substring(x FROM 3)) as u,\n      substring(x FROM 1 FOR 1) as s\n  from (\n    select 'table' as x from (values (true)) as t (a)\n    union\n    select 'view' from (values (true)) as t (a)\n    union\n    select 'foreign table' from (values (true)) as t (a)\n  ) as t\n) as t where u = 'TABLE';", "rewrites": [{"name": "testReduceConstantsCalc", "output_sql": "SELECT 'TABLE        ' AS \"u\", 't' AS \"s\"\nFROM (VALUES (TRUE)) AS \"t\" (\"expr$0\");"}]}
{"input_sql": "select empno from emp where empno>10 and empno<=10;", "rewrites": [{"name": "testReduceConstantsNegatedInverted", "output_sql": "SELECT \"empno\"\nFROM (VALUES (CAST(NULL AS INTEGER), CAST(NULL AS VARCHAR(20)), CAST(NULL AS VARCHAR(10)), CAST(NULL AS INTEGER), CAST(NULL AS TIMESTAMP), CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS BOOLEAN))) AS \"t\" (\"empno\", \"ename\", \"job\", \"mgr\", \"hiredate\", \"sal\", \"comm\", \"deptno\", \"slacker\")\nWHERE 1 = 0;"}]}
{"input_sql": "select sal\nfrom emp\nwhere empno IN (\n  select deptno from dept where emp.job = dept.name)\nAND empno IN (\n  select empno from emp e where emp.ename = e.ename);", "rewrites": [{"name": "testDecorrelateTwoIn", "output_sql": "SELECT \"emp\".\"sal\"\nFROM \"emp\"\n    INNER JOIN (SELECT *\n        FROM \"dept\" AS \"dept\" (\"deptno0\", \"name\")) AS \"t\" ON \"emp\".\"job\" = \"t\".\"name\" AND \"emp\".\"empno\" = \"t\".\"deptno0\"\n    INNER JOIN (SELECT \"empno0\", \"ename0\"\n        FROM \"emp\" AS \"emp0\" (\"empno0\", \"ename0\", \"job0\", \"mgr0\", \"hiredate0\", \"sal0\", \"comm0\", \"deptno1\", \"slacker0\")) AS \"t0\" ON \"emp\".\"ename\" = \"t0\".\"ename0\" AND \"emp\".\"empno\" = \"t0\".\"empno0\";"}]}
{"input_sql": "select empno, sum(sal), min(sal), max(sal),\n bit_and(distinct sal), bit_or(sal), count(distinct sal),\n grouping(deptno)\nfrom emp\ngroup by empno, deptno;", "rewrites": [{"name": "testAggregateRemove1", "output_sql": "SELECT \"empno\", \"sal\", \"sal\", \"sal\", \"sal\", \"sal\", 1, 0\nFROM \"emp\";"}]}
{"input_sql": "select distinct empno, deptno from emp;", "rewrites": [{"name": "testAggregateRemove2", "output_sql": "SELECT \"empno\", \"deptno\"\nFROM \"emp\";"}]}
{"input_sql": "select empno, count(mgr) from emp group by empno, deptno;", "rewrites": [{"name": "testAggregateRemove3", "output_sql": "SELECT \"empno\", CASE WHEN \"mgr\" IS NOT NULL THEN 1 ELSE 0 END\nFROM \"emp\";"}]}
{"input_sql": "select * from emp where empno > ANY (\n  select deptno from dept where emp.job = dept.name);", "rewrites": [{"name": "testWhereAnyCorrelatedInSelect", "output_sql": "SELECT \"emp\".\"empno\", \"emp\".\"ename\", \"emp\".\"job\", \"emp\".\"mgr\", \"emp\".\"hiredate\", \"emp\".\"sal\", \"emp\".\"comm\", \"emp\".\"deptno\", \"emp\".\"slacker\"\nFROM \"emp\"\n    INNER JOIN (SELECT MIN(\"deptno0\") AS \"m\", COUNT(*) AS \"c\", COUNT(*) AS \"c0\", TRUE AS \"trueliteral\", \"name\"\n        FROM \"dept\" AS \"dept\" (\"deptno0\", \"name\")\n        GROUP BY \"name\") AS \"t1\" ON \"emp\".\"job\" = \"t1\".\"name\" AND (\"emp\".\"empno\" > \"t1\".\"m\" AND (\"t1\".\"trueliteral\" IS NULL OR \"t1\".\"c\" = 0) IS NOT TRUE OR \"emp\".\"empno\" > \"t1\".\"m\" AND (\"t1\".\"trueliteral\" IS NULL OR \"t1\".\"c\" = 0) IS NOT TRUE AND \"emp\".\"empno\" > \"t1\".\"m\" IS NOT TRUE AND \"t1\".\"c\" > \"t1\".\"c0\" IS NOT TRUE);"}]}
{"input_sql": "select empno from emp where empno=10 and empno is null;", "rewrites": [{"name": "testReduceConstantsIsNull", "output_sql": "SELECT \"empno\"\nFROM (VALUES (CAST(NULL AS INTEGER), CAST(NULL AS VARCHAR(20)), CAST(NULL AS VARCHAR(10)), CAST(NULL AS INTEGER), CAST(NULL AS TIMESTAMP), CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS BOOLEAN))) AS \"t\" (\"empno\", \"ename\", \"job\", \"mgr\", \"hiredate\", \"sal\", \"comm\", \"deptno\", \"slacker\")\nWHERE 1 = 0;"}]}
{"input_sql": "select empno from emp\nwhere empno=10 and not(empno=10);", "rewrites": [{"name": "testReduceConstantsNegated", "output_sql": "SELECT \"empno\"\nFROM (VALUES (CAST(NULL AS INTEGER), CAST(NULL AS VARCHAR(20)), CAST(NULL AS VARCHAR(10)), CAST(NULL AS INTEGER), CAST(NULL AS TIMESTAMP), CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS BOOLEAN))) AS \"t\" (\"empno\", \"ename\", \"job\", \"mgr\", \"hiredate\", \"sal\", \"comm\", \"deptno\", \"slacker\")\nWHERE 1 = 0;"}]}
{"input_sql": "select empno, deptno, w_count from (\n  select empno, deptno, count(empno) over (w) w_count\n  from emp\n  window w as (partition by deptno order by empno)\n) sub_query where w_count is null;", "rewrites": [{"name": "testIsNullPushDown", "output_sql": "SELECT \"empno\", \"deptno\", \"$2\" AS \"w_count\"\nFROM (VALUES (CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS BIGINT))) AS \"t\" (\"empno\", \"deptno\", \"$2\")\nWHERE 1 = 0;"}]}
{"input_sql": "select sum(distinct deptno), count(distinct deptno), max(deptno) from emp;", "rewrites": [{"name": "testMaxReuseDistinctAttrWithMixedOptionality", "output_sql": "SELECT SUM(\"deptno\"), COUNT(\"deptno\"), MAX(\"deptno\")\nFROM (SELECT \"deptno\"\n        FROM \"emp\"\n        GROUP BY \"deptno\") AS \"t0\";"}]}
{"input_sql": "SELECT SUM(comm), SUM(DISTINCT comm) FROM emp;", "rewrites": [{"name": "testSumAndDistinctSumWithExpandSumType", "output_sql": "SELECT CAST(SUM(\"expr$0\") AS BIGINT), SUM(\"comm\")\nFROM (SELECT \"comm\", SUM(\"comm\") AS \"expr$0\"\n        FROM \"emp\"\n        GROUP BY \"comm\") AS \"t0\";"}]}
{"input_sql": "select deptno c, min(y), max(z) z,\nsum(r), sum(m) n, sum(x) sal from (\n   select deptno, ename, sum(sal) x, max(sal) z,\n      min(sal) y, count(hiredate) m, count(mgr) r\n   from emp group by deptno, ename) t\ngroup by deptno;", "rewrites": [{"name": "testAggregateMerge1", "output_sql": "SELECT \"deptno\", MIN(\"sal\"), MAX(\"sal\") AS \"z\", COUNT(\"mgr\"), COUNT(*) AS \"n\", SUM(\"sal\") AS \"sal\"\nFROM \"emp\"\nGROUP BY \"deptno\";"}]}
{"input_sql": "select a + b as x, b, a from (values (10, 1), (30, 7)) as t(a, b)\nwhere a - b < 0;", "rewrites": [{"name": "testReduceValuesToEmpty", "output_sql": "SELECT *\nFROM (VALUES (CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS INTEGER))) AS \"t\" (\"x\", \"b\", \"a\")\nWHERE 1 = 0;"}]}
{"input_sql": "select coalesce(sum(count_comm), 0)\nfrom (\n  select deptno, count(comm) as count_comm\n  from emp\n  group by deptno, mgr) t;", "rewrites": [{"name": "testAggregateMergeSum0", "output_sql": "SELECT COUNT(*) AS \"$f0\"\nFROM \"emp\";"}]}
{"input_sql": "select e.mgr, d.mgr\nfrom emp as e\nfull outer join emp as d on e.mgr = d.mgr\ngroup by d.mgr, e.mgr;", "rewrites": [{"name": "testPushAggregateThroughOuterJoin14", "output_sql": "SELECT \"t\".\"mgr\", \"t0\".\"mgr0\"\nFROM (SELECT \"mgr\"\n        FROM \"emp\"\n        GROUP BY \"mgr\") AS \"t\"\n    FULL JOIN (SELECT \"mgr0\"\n        FROM \"emp\" AS \"emp0\" (\"empno0\", \"ename0\", \"job0\", \"mgr0\", \"hiredate0\", \"sal0\", \"comm0\", \"deptno0\", \"slacker0\")\n        GROUP BY \"mgr0\") AS \"t0\" ON \"t\".\"mgr\" = \"t0\".\"mgr0\"\nGROUP BY \"t\".\"mgr\", \"t0\".\"mgr0\";"}]}
{"input_sql": "select dname, ddeptno, c from\n             (select name dname, deptno ddeptno, count(*) as c\n             from dept group by grouping sets ((name,deptno),(name))) t\n              where dname = 'Charlie';", "rewrites": [{"name": "testPushFilterPastAggWithGroupingSets2", "output_sql": "SELECT \"dname\", \"ddeptno\", COUNT(*) AS \"c\"\nFROM (SELECT \"name\" AS \"dname\", \"deptno\" AS \"ddeptno\"\n        FROM \"dept\") AS \"t\"\nWHERE \"dname\" = 'Charlie'\nGROUP BY GROUPING SETS((\"dname\", \"ddeptno\"), \"dname\");"}]}
{"input_sql": "select sum(distinct deptno), count(distinct deptno), bit_or(deptno) from emp;", "rewrites": [{"name": "testBitOrReuseDistinctAttrWithMixedOptionality", "output_sql": "SELECT SUM(\"deptno\"), COUNT(\"deptno\"), BIT_OR(\"deptno\")\nFROM (SELECT \"deptno\"\n        FROM \"emp\"\n        GROUP BY \"deptno\") AS \"t0\";"}]}
{"input_sql": "select * from dept as d\nwhere EXISTS (\n  select count(*) from emp e where d.deptno = e.deptno);", "rewrites": [{"name": "testExistsWithAtLeastOneRowSubQuery", "output_sql": "SELECT *\nFROM \"dept\";"}]}
{"input_sql": "select name, deptno > ANY (\n  select deptno from emp)\nfrom dept;", "rewrites": [{"name": "testAnyInProjectNonNullable", "output_sql": "SELECT \"dept\".\"name\", CAST(\"dept\".\"deptno\" > \"t1\".\"m\" IS TRUE AND \"t1\".\"c\" <> 0 OR \"t1\".\"c\" > \"t1\".\"c0\" AND NULL AND \"t1\".\"c\" <> 0 AND \"dept\".\"deptno\" > \"t1\".\"m\" IS NOT TRUE OR \"dept\".\"deptno\" > \"t1\".\"m\" AND \"t1\".\"c\" <> 0 AND \"dept\".\"deptno\" > \"t1\".\"m\" IS NOT TRUE AND \"t1\".\"c\" <= \"t1\".\"c0\" AS BOOLEAN)\nFROM \"dept\",\n        (SELECT MIN(\"deptno0\") AS \"m\", COUNT(*) AS \"c\", COUNT(*) AS \"c0\"\n        FROM \"emp\" AS \"emp\" (\"empno\", \"ename\", \"job\", \"mgr\", \"hiredate\", \"sal\", \"comm\", \"deptno0\", \"slacker\")) AS \"t1\";"}]}
{"input_sql": "select distinct d.deptno\nfrom emp e\nright outer join dept d on e.deptno = d.deptno;", "rewrites": [{"name": "testAggregateJoinRemove4", "output_sql": "SELECT \"deptno\"\nFROM \"dept\";"}]}
{"input_sql": "select d.deptno, count(distinct d.name)\nfrom emp e\nright outer join dept d on e.deptno = d.deptno\ngroup by d.deptno;", "rewrites": [{"name": "testAggregateJoinRemove5", "output_sql": "SELECT \"deptno\", COUNT(DISTINCT \"name\")\nFROM \"dept\"\nGROUP BY \"deptno\";"}]}
{"input_sql": "select sal,\n empno NOT IN (\n select deptno from dept\n   where emp.job=dept.name)\n from emp;", "rewrites": [{"name": "testSelectNotInCorrelated", "output_sql": "SELECT \"emp\".\"sal\", \"t\".\"i\" IS NULL\nFROM \"emp\"\n    LEFT JOIN (SELECT \"deptno0\", TRUE AS \"i\", \"name\"\n        FROM \"dept\" AS \"dept\" (\"deptno0\", \"name\")) AS \"t\" ON \"emp\".\"empno\" = \"t\".\"deptno0\" AND \"emp\".\"job\" = \"t\".\"name\";"}]}
{"input_sql": "SELECT count(comm), COUNT(DISTINCT comm) FROM emp;", "rewrites": [{"name": "testDistinctCountWithExpandSumType", "output_sql": "SELECT CAST(COALESCE(SUM(\"expr$0\"), 0) AS BIGINT), COUNT(\"comm\")\nFROM (SELECT \"comm\", COUNT(*) AS \"expr$0\"\n        FROM \"emp\"\n        GROUP BY \"comm\") AS \"t0\";"}]}
{"input_sql": "select * from (select * from emp where deptno = 10) as t\nwhere deptno + 5 > empno;", "rewrites": [{"name": "testPullConstantIntoFilter", "output_sql": "SELECT *\nFROM (SELECT *\n        FROM \"emp\"\n        WHERE \"deptno\" = 10) AS \"t\"\nWHERE 15 > \"empno\";"}]}
{"input_sql": "select * from emp order by deptno limit 0;", "rewrites": [{"name": "testEmptySortLimitZero", "output_sql": "SELECT *\nFROM (VALUES (CAST(NULL AS INTEGER), CAST(NULL AS VARCHAR(20)), CAST(NULL AS VARCHAR(10)), CAST(NULL AS INTEGER), CAST(NULL AS TIMESTAMP), CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS INTEGER), CAST(NULL AS BOOLEAN))) AS \"t\" (\"empno\", \"ename\", \"job\", \"mgr\", \"hiredate\", \"sal\", \"comm\", \"deptno\", \"slacker\")\nWHERE 1 = 0;"}]}
{"input_sql": "SELECT empno, SUM(distinct sal), MIN(sal), MIN(distinct sal), MAX(distinct sal), bit_and(distinct sal), bit_or(sal), count(distinct sal) from emp group by empno, deptno;", "rewrites": [{"name": "testRemoveDistinctOnAgg", "output_sql": "SELECT \"empno\", \"sal\", \"sal\", \"sal\", \"sal\", \"sal\", \"sal\", 1\nFROM \"emp\";"}]}
{"input_sql": "select * from (values (30, 3)) as t (x, y) intersect\nselect *\nfrom (values (10, 1), (30, 3)) as t (x, y) where x > 50\nintersect\nselect * from (values (30, 3)) as t (x, y);", "rewrites": [{"name": "testEmptyIntersect", "output_sql": "SELECT *\nFROM (VALUES (CAST(NULL AS INTEGER), CAST(NULL AS INTEGER))) AS \"t\" (\"expr$0\", \"expr$1\")\nWHERE 1 = 0;"}]}
{"input_sql": "with e2 as (\n  select empno, case when true then deptno else null end as deptno\n  from emp)\nselect empno,\n  deptno in (select deptno from e2 where empno < 20) as d\nfrom e2;", "rewrites": [{"name": "testExpandProjectInNullable", "output_sql": "SELECT \"emp\".\"empno\", CASE WHEN \"t2\".\"c\" = 0 THEN FALSE WHEN CASE WHEN TRUE THEN CAST(\"emp\".\"deptno\" AS INTEGER) ELSE NULL END IS NULL THEN NULL WHEN \"t6\".\"i\" IS NOT NULL THEN TRUE WHEN \"t2\".\"ck\" < \"t2\".\"c\" THEN NULL ELSE FALSE END AS \"d\"\nFROM \"emp\"\n    CROSS JOIN (SELECT COUNT(*) AS \"c\", COUNT(\"deptno1\") AS \"ck\"\n        FROM (SELECT \"empno0\", CASE WHEN TRUE THEN CAST(\"deptno0\" AS INTEGER) ELSE NULL END AS \"deptno1\"\n                FROM \"emp\" AS \"emp0\" (\"empno0\", \"ename0\", \"job0\", \"mgr0\", \"hiredate0\", \"sal0\", \"comm0\", \"deptno0\", \"slacker0\")) AS \"t\"\n        WHERE \"empno0\" < 20) AS \"t2\"\n    LEFT JOIN (SELECT \"deptno3\", TRUE AS \"i\"\n        FROM (SELECT \"empno1\", CASE WHEN TRUE THEN CAST(\"deptno2\" AS INTEGER) ELSE NULL END AS \"deptno3\"\n                FROM \"emp\" AS \"emp1\" (\"empno1\", \"ename1\", \"job1\", \"mgr1\", \"hiredate1\", \"sal1\", \"comm1\", \"deptno2\", \"slacker1\")) AS \"t3\"\n        WHERE \"empno1\" < 20\n        GROUP BY \"deptno3\") AS \"t6\" ON CASE WHEN TRUE THEN CAST(\"emp\".\"deptno\" AS INTEGER) ELSE NULL END = \"t6\".\"deptno3\";"}]}
{"input_sql": "select sum(distinct deptno), count(distinct deptno), min(deptno) from emp;", "rewrites": [{"name": "testMinReuseDistinctAttrWithMixedOptionality", "output_sql": "SELECT SUM(\"deptno\"), COUNT(\"deptno\"), MIN(\"deptno\")\nFROM (SELECT \"deptno\"\n        FROM \"emp\"\n        GROUP BY \"deptno\") AS \"t0\";"}]}
